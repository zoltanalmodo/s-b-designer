<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>strecther bar designer</title>
<style>
  :root { --bg:#fbfbfb; --ink:#111; --card:#fff; --accent:#2563eb; }
  * { box-sizing: border-box; }
  html, body { height:100%; }
  body{
    font:14px/1.4 system-ui,Segoe UI,Helvetica,Arial,sans-serif;
    background:var(--bg);
    color:var(--ink);
    margin:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
  }
  .container{
    flex:1 1 auto;
    display:flex;
    justify-content:center;
    padding:4px;
    background:rgba(255,231,150,0.35); /* debug: container padding */
  }
  .panel{
    background:rgba(255,255,255,0.95);
    border:1px solid rgba(0,0,0,0.88);
    border-radius:14px;
    padding:12px 12px 0;
    max-width:820px;
    width:100%;
    display:flex;
    flex-direction:column;
    gap:0;
    position:relative;
  }
  .panel::after{
    content:"";
    position:absolute;
    left:0;
    right:0;
    bottom:0;
    height:12px;
    background:rgba(200,160,255,0.35); /* debug: panel bottom padding */
  }
  @media (min-width: 980px){
    .container{padding:8px;}
    .panel{padding:18px 20px;}
  }
  .canvasWrap{
    padding:0;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:clamp(220px, 48vh, 640px);
  }
  #svg{
    display:block;
    width:100%;
    height:100%;
    max-width:none;
    max-height:none;
    flex:1 1 auto;
    background:rgba(255,206,206,0.25); /* debug: raw SVG footprint */
  }
  .outline{fill:url(#hatch); stroke:#111; stroke-width:3.5}
  .proj{stroke:#111; stroke-width:1; fill:none}
  .dim{stroke:#111; stroke-width:1.8; fill:none; marker-start:url(#arrowTip); marker-end:url(#arrowTip)}
  .lbl{font-weight:700; font-size:20px; fill:#111}
  .lbl.chamfer{font-size:16px; font-weight:600;}
  .area{font-weight:600; font-size:16px}
  .inputs{
    padding:0;
    display:flex;
    flex-direction:column;
    gap:6px;
    background:rgba(204,252,204,0.35); /* debug: inputs block */
    border-bottom:0;
  }
  .row{
    display:grid;
    grid-template-columns:auto max-content max-content minmax(160px,1fr);
    align-items:center;
    gap:8px;
    margin:0;
    padding:2px 0;
  }
  .row label{font-weight:600; white-space:nowrap;}
  .row input[type="number"]{width:68px; padding:4px 5px; text-align:right; font:600 14px system-ui; border:1px solid #dcdcdc; border-radius:8px; background:#fff; justify-self:end;}
  .unit{color:#333; white-space:nowrap; justify-self:end; min-width:28px; text-align:right;}
  .slider{width:100%; height:30px; display:flex; align-items:center; justify-content:flex-end;}
  input[type="range"]{width:100%; max-width:300px; min-width:120px; -webkit-appearance:none; appearance:none; height:3px; border-radius:2px; background:#d7def0; outline:none;}
  input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:28px; height:28px; border-radius:50%; background:var(--accent); border:2px solid #0b3ea8; box-shadow:0 1px 2px rgba(0,0,0,.25); }
  input[type="range"]::-moz-range-thumb{ width:28px; height:28px; border-radius:50%; background:var(--accent); border:2px solid #0b3ea8; }
  @media (max-width: 540px){
    .panel{padding:20px 16px;}
    .row{
      grid-template-columns:auto max-content max-content minmax(120px,1fr);
      gap:8px;
    }
    .row input[type="number"]{width:64px;}
    input[type="range"]{min-width:100px; max-width:240px;}
  }
</style>

<div class="container">
  <div class="panel">
    <div class="canvasWrap">
      <svg id="svg" viewBox="0 0 1300 820" xmlns="http://www.w3.org/2000/svg" aria-label="Cross section" preserveAspectRatio="xMidYMid meet">
        <defs>
          <pattern id="hatch" width="12" height="12" patternUnits="userSpaceOnUse" patternTransform="rotate(30)">
            <line x1="0" y1="0" x2="0" y2="12" stroke="#9aa3aa" stroke-width="2"/>
          </pattern>
          <marker id="arrowTip" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
            <path d="M0,0 L10,5 L0,10 Z" fill="#111"/>
          </marker>
        </defs>

        <g id="drawing">
          <polygon id="shape" class="outline" points=""/>
          <g id="proj" class="proj"></g>
          <g id="dims" class="dim"></g>
          <g id="labels" class="lbl"></g>
          <text id="chText" class="lbl chamfer">~ 15° chamfer</text>
          <text id="areaText" class="area" x="18" y="804"></text>
        </g>
      </svg>
    </div>

    <div class="inputs">
      <div class="row">
        <label for="D_val">D = Depth</label>
        <input id="D_val" type="number" min="24" max="50" step="1" value="24">
        <div class="unit">mm</div>
        <div class="slider"><input id="D_range" type="range" min="24" max="50" step="1" value="24"></div>
      </div>

      <div class="row">
        <label for="T_val">T = Thickness</label>
        <input id="T_val" type="number" min="2" max="70" step="1" value="70">
        <div class="unit">mm</div>
        <div class="slider"><input id="T_range" type="range" min="2" max="70" step="1" value="70"></div>
      </div>

      <div class="row">
        <label for="A_val">A = Wing A</label>
        <input id="A_val" type="number" min="16" max="70" step="1" value="30">
        <div class="unit">mm</div>
        <div class="slider"><input id="A_range" type="range" min="16" max="70" step="1" value="30"></div>
      </div>

      <div class="row">
        <label for="B_val">B = Wing B</label>
        <input id="B_val" type="number" min="16" max="42" step="1" value="16">
        <div class="unit">mm</div>
        <div class="slider"><input id="B_range" type="range" min="16" max="42" step="1" value="16"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const Dv=$('D_val'), Tv=$('T_val'), Av=$('A_val'), Bv=$('B_val');
  const Dr=$('D_range'), Tr=$('T_range'), Ar=$('A_range'), Br=$('B_range');

  const svgEl = document.getElementById('svg');
  const drawing = document.getElementById('drawing');
  const shape = document.getElementById('shape');
  const gProj = document.getElementById('proj');
  const gDims = document.getElementById('dims');
  const gLabels = document.getElementById('labels');
  const chText = document.getElementById('chText');
  const areaText = document.getElementById('areaText');

  let s = 4;
  let margin = { l:56, t:64, r:56, b:120 };
  let viewW = 1300, viewH = 820;
  const projOver = 10, gap = 40, tan15 = Math.tan(15 * Math.PI/180);
  const BMAX = 42;

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function link(num, rng){ num.addEventListener('input', ()=>{ rng.value=num.value; update(); });
                           rng.addEventListener('input', ()=>{ num.value=rng.value; update(); }); }
  [ [Dv,Dr],[Tv,Tr],[Av,Ar],[Bv,Br] ].forEach(([n,r])=>link(n,r));

  function computeScale(D,T){
    const cw = svgEl.clientWidth || 1300;
    const ch = svgEl.clientHeight || 820;
    const sidePad = Math.max(30, Math.min(44, cw * 0.115));
    const topPad = Math.max(40, Math.min(56, ch * 0.12));
    const bottomPad = Math.max(70, Math.min(110, ch * 0.18));
    const dimPad = sidePad;
    const leftExtra = dimPad;
    const rightExtra = dimPad;
    const widthMargin = Math.max(18, cw * 0.06);
    const heightMargin = Math.max(20, ch * 0.08);
    const availableW = Math.max(140, cw - (leftExtra + rightExtra + widthMargin * 2));
    const availableH = Math.max(200, ch - (topPad + bottomPad + heightMargin * 2));
    const sx = availableW / T;
    const sy = availableH / D;
    const safeS = Math.min(sx, sy);
    s = Math.min(24, safeS * 0.9);
    const actualW = T * s + leftExtra + rightExtra + widthMargin * 2;
    const actualH = D * s + topPad + bottomPad + heightMargin * 2;
    const extraW = Math.max(0, cw - actualW);
    const extraH = Math.max(0, ch - actualH);
    margin = {
      l: leftExtra + widthMargin + extraW / 2,
      r: rightExtra + widthMargin + extraW / 2,
      t: topPad + heightMargin + extraH / 2,
      b: bottomPad + heightMargin + extraH / 2
    };
    viewW = cw;
    viewH = ch;
  }

  function enforce(){
    let D = +Dv.value||24, T = +Tv.value||70, A = +Av.value||30, B = +Bv.value||16;
    B = clamp(B, 16, BMAX);
    D = clamp(D, 24, 50);
    if (B > 16){ D = B + 8; if (D > 50){ D = 50; B = 42; } }
    if (B > D - 8){ const need = B + 8; if (need <= 50) D = need; else { D = 50; B = 42; } }
    const Tmin = Math.ceil(1.5 * D);
    if (T < Tmin) T = Tmin;
    if (T > 70){ D = Math.floor(70/1.5); if (B > 16) B = D - 8; T = 70; }
    let Areq = Math.ceil((D - B) / tan15);
    if (Areq > 70){
      const maxDelta = Math.floor(70 * tan15);
      D = Math.min(50, Math.max(24, B + maxDelta));
      if (B > 16) B = D - 8;
      Areq = Math.ceil((D - B) / tan15);
    }
    A = clamp(Math.max(A, Areq, 16), 16, 70);
    if (A > T) T = clamp(A, Tmin, 70);
    Dv.value = Dr.value = String(D);
    Tv.value = Tr.value = String(T);
    Av.value = Ar.value = String(A);
    Bv.value = Br.value = String(B);
    Tr.min = String(Math.min(70, Math.ceil(1.5*D))); Tr.max = "70";
    Ar.min = String(Math.max(16, Math.ceil((D - B) / tan15))); Ar.max = "70";
    Br.min = "16"; Br.max = String(BMAX);
    Dv.min = Dr.min = "24"; Dv.max = Dr.max = "50";
    computeScale(D,T);
    return {D,T,A,B};
  }

  function addLine(g,x1,y1,x2,y2,cls){ const e=document.createElementNS('http://www.w3.org/2000/svg','line');
    e.setAttribute('x1',x1); e.setAttribute('y1',y1); e.setAttribute('x2',x2); e.setAttribute('y2',y2);
    e.setAttribute('class',cls); g.appendChild(e); return e; }
  function addText(g,x,y,t,anchor='middle'){ const e=document.createElementNS('http://www.w3.org/2000/svg','text');
    e.setAttribute('x',x); e.setAttribute('y',y); e.setAttribute('text-anchor',anchor);
    e.setAttribute('class','lbl'); e.textContent=t; g.appendChild(e); return e; }

  function update(){
    drawing.setAttribute('transform','');
    const {D,T,A,B} = enforce();
    svgEl.setAttribute('viewBox', `0 0 ${viewW} ${viewH}`);
    const ox = margin.l, oy = margin.t;
    const Wpx = T*s, Hpx = D*s;
    const xA = ox + A*s;
    const yBtop = oy + (D - B)*s;
    const xRight = ox + Wpx, yBottom = oy + Hpx;
    const polyPts = [[ox,yBottom],[xRight,yBottom],[xRight,yBtop],[xA,yBtop],[ox,oy],[ox,yBottom]];
    shape.setAttribute('points', polyPts.map(p=>p.join(',')).join(' '));
    gProj.innerHTML=''; gDims.innerHTML=''; gLabels.innerHTML='';
    const dimOffset = Math.max(36, Math.min(80, s * 7));
    const xDimD = ox - dimOffset;
    addLine(gProj, ox, oy, xDimD - projOver, oy, 'proj');
    addLine(gProj, ox, yBottom, xDimD - projOver, yBottom, 'proj');
    addLine(gDims, xDimD, oy, xDimD, yBottom, 'dim');
    addText(gLabels, xDimD - 22, oy + (Hpx/2) + 6, 'D');
    const yDimT = yBottom + gap;
    addLine(gProj, ox, yBottom, ox, yDimT + projOver, 'proj');
    addLine(gProj, xRight, yBottom, xRight, yDimT + projOver, 'proj');
    addLine(gDims, ox, yDimT, xRight, yDimT, 'dim');
    addText(gLabels, ox + (Wpx/2), yDimT + 32, 'T');
    const yDimA = oy - gap;
    addLine(gProj, ox, oy, ox, yDimA - projOver, 'proj');
    addLine(gProj, xA, yBtop, xA, yDimA - projOver, 'proj');
    addLine(gDims, ox, yDimA, xA, yDimA, 'dim');
    addText(gLabels, ox + (xA - ox)/2, yDimA - 14, 'A');
    const xDimB = xRight + dimOffset;
    addLine(gProj, xRight, yBtop, xDimB + projOver, yBtop, 'proj');
    addLine(gProj, xRight, yBottom, xDimB + projOver, yBottom, 'proj');
    addLine(gDims, xDimB, yBtop, xDimB, yBottom, 'dim');
    addText(gLabels, xDimB + 22, yBtop + (yBottom - yBtop)/2 + 6, 'B');
    chText.textContent = "\u223C 15\u00B0 chamfer";
    chText.setAttribute('text-anchor','end');
    chText.setAttribute('x', xRight);
    chText.setAttribute('y', oy - 14);
    const area = T*D - (T - A)*(D - B) - 0.5 * A * (D - B);
    const areaY = Math.min(804, yBottom + gap + 54);
    areaText.textContent = `area: ${Math.round(area)} mm²`;
    areaText.setAttribute('x', ox + Wpx / 2);
    areaText.setAttribute('y', areaY);
    areaText.setAttribute('text-anchor','middle');
    const bbox = drawing.getBBox();
    const vb = svgEl.viewBox.baseVal;
    const centerX = vb.x + vb.width / 2;
    const bboxCenterX = bbox.x + bbox.width / 2;
    const dx = centerX - bboxCenterX;
    drawing.setAttribute('transform', `translate(${dx},0)`);
  }

  ['input','change'].forEach(ev => [Dv,Tv,Av,Bv,Dr,Tr,Ar,Br].forEach(el => el.addEventListener(ev, update)));
  window.addEventListener('resize', update);
  update();
})();
</script>
