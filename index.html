<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>strecther bar designer</title>
<style>
  :root { --bg:#fbfbfb; --ink:#111; --card:#fff; --accent:#2563eb; }
  * { box-sizing: border-box; }
  body{font:14px/1.4 system-ui,Segoe UI,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink); margin:0;}
  header{padding:12px 12px 6px;}
  h1{margin:0; font-size:22px; line-height:1.15; letter-spacing:.2px;}
  .container{display:grid; grid-template-columns:1fr; gap:10px; padding:0 10px 12px;}
  .panel{background:var(--card); border:1px solid #e2e2e2; border-radius:12px;}
  .canvasWrap{padding:6px; overflow:hidden;}
  #svg{display:block; width:100%; height:auto; max-height:48vh;}
  .outline{fill:url(#hatch); stroke:#111; stroke-width:3.5}
  .proj{stroke:#111; stroke-width:1; fill:none}
  .dim{stroke:#111; stroke-width:1.8; fill:none; marker-start:url(#arrowTip); marker-end:url(#arrowTip)}
  .lbl{font-weight:700; font-size:14px; fill:#111}
  .title{font-weight:800; font-size:14px}
  .area{font-weight:800; font-size:16px}
  .inputs{padding:8px 8px 6px}
  .legend{font-weight:800; font-size:16px; margin:0 0 4px 0;}
  .row{display:grid; grid-template-columns:auto 56px; align-items:center; gap:6px; margin:6px 0 10px;}
  .row label{font-weight:600; font-size:14px;}
  .badge{display:inline-block; min-width:48px; padding:4px 6px; text-align:center; border:1px solid #dcdcdc; border-radius:8px; font-weight:700; background:#f7f7f7;}
  .slider{grid-column: 1 / 3; width:100%; height:36px; display:flex; align-items:center;}
  input[type="range"]{width:100%; -webkit-appearance:none; appearance:none; height:4px; border-radius:2px; background:#d7def0; outline:none;}
  input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:28px; height:28px; border-radius:50%; background:var(--accent); border:2px solid #0b3ea8; box-shadow:0 1px 2px rgba(0,0,0,.25); }
  input[type="range"]::-moz-range-thumb{ width:28px; height:28px; border-radius:50%; background:var(--accent); border:2px solid #0b3ea8; }
</style>

<header>
  <h1>strecther bar designer</h1>
</header>

<div class="container">
  <div class="panel canvasWrap">
    <svg id="svg" viewBox="0 0 1100 700" xmlns="http://www.w3.org/2000/svg" aria-label="Cross section" preserveAspectRatio="xMidYMid meet">
      <defs>
        <pattern id="hatch" width="12" height="12" patternUnits="userSpaceOnUse" patternTransform="rotate(30)">
          <line x1="0" y1="0" x2="0" y2="12" stroke="#9aa3aa" stroke-width="2"/>
        </pattern>
        <marker id="arrowTip" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
          <path d="M0,0 L10,5 L0,10 Z" fill="#111"/>
        </marker>
      </defs>

      <text x="18" y="26" class="title">Cross Section</text>
      <polygon id="shape" class="outline" points=""/>
      <g id="proj" class="proj"></g>
      <g id="dims" class="dim"></g>
      <g id="labels" class="lbl"></g>
      <text id="chText" class="lbl">~ 15° chamfer</text>
      <text id="areaText" class="area" x="18" y="676"></text>
    </svg>
  </div>

  <div class="panel inputs">
    <div class="legend">Inputs</div>
    <div class="row">
      <label for="D_range">D = Depth</label>
      <span id="D_badge" class="badge">24</span>
      <div class="slider"><input id="D_range" type="range" min="24" max="50" step="1" value="24"></div>
    </div>
    <div class="row">
      <label for="T_range">T = Thickness</label>
      <span id="T_badge" class="badge">70</span>
      <div class="slider"><input id="T_range" type="range" min="2" max="70" step="1" value="70"></div>
    </div>
    <div class="row">
      <label for="A_range">A = Wing A</label>
      <span id="A_badge" class="badge">30</span>
      <div class="slider"><input id="A_range" type="range" min="16" max="70" step="1" value="30"></div>
    </div>
    <div class="row" style="margin-bottom:4px">
      <label for="B_range">B = Wing B</label>
      <span id="B_badge" class="badge">16</span>
      <div class="slider"><input id="B_range" type="range" min="16" max="42" step="1" value="16"></div>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const Dr = $('D_range'), Tr = $('T_range'), Ar = $('A_range'), Br = $('B_range');
  const D_badge = $('D_badge'), T_badge = $('T_badge'), A_badge = $('A_badge'), B_badge = $('B_badge');

  const shape = document.getElementById('shape');
  const gProj = document.getElementById('proj');
  const gDims = document.getElementById('dims');
  const gLabels = document.getElementById('labels');
  const chText = document.getElementById('chText');
  const areaText = document.getElementById('areaText');

  let s = 4;
  let margin = { l:60, t:70, r:70, b:120 };
  const projOver = 8, gap = 38, tan15 = Math.tan(15 * Math.PI/180);
  const BMAX = 42;

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function computeScale(D,T){
    const svg = document.getElementById('svg');
    const cw = svg.clientWidth || 1100;
    const ch = svg.clientHeight || 700;
    if (cw < 420){ margin = { l:46, t:64, r:56, b:108 }; }
    const innerW = Math.max(180, cw - (margin.l + margin.r));
    const innerH = Math.max(180, ch - (margin.t + margin.b));
    const sx = innerW / (T + 36);
    const sy = innerH / (D + 36);
    s = Math.max(3.6, Math.min(9.5, Math.min(sx, sy)));
  }

  function enforce(){
    let D = +Dr.value||24, T = +Tr.value||70, A = +Ar.value||30, B = +Br.value||16;
    B = clamp(B, 16, BMAX);
    D = clamp(D, 24, 50);
    if (B > 16){ D = B + 8; if (D > 50){ D = 50; B = 42; } }
    if (B > D - 8){ const need = B + 8; if (need <= 50) D = need; else { D = 50; B = 42; } }
    const Tmin = Math.ceil(1.5 * D);
    if (T < Tmin) T = Tmin;
    if (T > 70){ D = Math.floor(70/1.5); if (B > 16) B = D - 8; T = 70; }
    let Areq = Math.ceil((D - B) / tan15);
    if (Areq > 70){
      const maxDelta = Math.floor(70 * tan15);
      D = Math.min(50, Math.max(24, B + maxDelta));
      if (B > 16) B = D - 8;
      Areq = Math.ceil((D - B) / tan15);
    }
    A = clamp(Math.max(A, Areq, 16), 16, 70);
    if (A > T) T = clamp(A, Tmin, 70);

    Dr.min = "24"; Dr.max = "50"; Dr.value = String(D);
    Tr.min = String(Math.min(70, Math.ceil(1.5*D))); Tr.max = "70"; Tr.value = String(T);
    Ar.min = String(Math.max(16, Math.ceil((D - B) / tan15))); Ar.max = "70"; Ar.value = String(A);
    Br.min = "16"; Br.max = String(BMAX); Br.value = String(B);

    D_badge.textContent = D; T_badge.textContent = T; A_badge.textContent = A; B_badge.textContent = B;

    computeScale(D,T);
    return {D,T,A,B};
  }

  function addLine(g,x1,y1,x2,y2,cls){ const e=document.createElementNS('http://www.w3.org/2000/svg','line');
    e.setAttribute('x1',x1); e.setAttribute('y1',y1); e.setAttribute('x2',x2); e.setAttribute('y2',y2);
    e.setAttribute('class',cls); g.appendChild(e); return e; }
  function addText(g,x,y,t,anchor='middle'){ const e=document.createElementNS('http://www.w3.org/2000/svg','text');
    e.setAttribute('x',x); e.setAttribute('y',y); e.setAttribute('text-anchor',anchor);
    e.setAttribute('class','lbl'); e.textContent=t; g.appendChild(e); return e; }

  function update(){
    const {D,T,A,B} = enforce();
    const ox = margin.l, oy = margin.t;
    const Wpx = T*s, Hpx = D*s;
    const xA = ox + A*s;
    const yBtop = oy + (D - B)*s;
    const xRight = ox + Wpx, yBottom = oy + Hpx;
    const polyPts = [[ox,yBottom],[xRight,yBottom],[xRight,yBtop],[xA,yBtop],[ox,oy],[ox,yBottom]];
    shape.setAttribute('points', polyPts.map(p=>p.join(',')).join(' '));
    gProj.innerHTML=''; gDims.innerHTML=''; gLabels.innerHTML='';
    const xDimD = ox - 44;
    addLine(gProj, ox, oy, xDimD - 8, oy, 'proj');
    addLine(gProj, ox, yBottom, xDimD - 8, yBottom, 'proj');
    addLine(gDims, xDimD, oy, xDimD, yBottom, 'dim');
    addText(gLabels, xDimD - 18, oy + (Hpx/2) + 4, 'D');
    const yDimT = yBottom + gap;
    addLine(gProj, ox, yBottom, ox, yDimT + 8, 'proj');
    addLine(gProj, xRight, yBottom, xRight, yDimT + 8, 'proj');
    addLine(gDims, ox, yDimT, xRight, yDimT, 'dim');
    addText(gLabels, ox + (Wpx/2), yDimT + 24, 'T');
    const yDimA = oy - gap;
    addLine(gProj, ox, oy, ox, yDimA - 8, 'proj');
    addLine(gProj, xA, yBtop, xA, yDimA - 8, 'proj');
    addLine(gDims, ox, yDimA, xA, yDimA, 'dim');
    addText(gLabels, ox + (xA - ox)/2, yDimA - 10, 'A');
    const xDimB = xRight + 44;
    addLine(gProj, xRight, yBtop, xDimB + 8, yBtop, 'proj');
    addLine(gProj, xRight, yBottom, xDimB + 8, yBottom, 'proj');
    addLine(gDims, xDimB, yBtop, xDimB, yBottom, 'dim');
    addText(gLabels, xDimB + 18, yBtop + (yBottom - yBtop)/2 + 4, 'B');
    chText.textContent = "\u223C 15\u00B0 chamfer";
    chText.setAttribute('x', xRight + 16);
    chText.setAttribute('y', oy - 8);
    const area = T*D - (T - A)*(D - B) - 0.5 * A * (D - B);
    areaText.textContent = `Area: ${Math.round(area)} mm²`;
  }

  ['input','change'].forEach(ev => [Dr,Tr,Ar,Br].forEach(el => el.addEventListener(ev, update)));
  window.addEventListener('resize', update);
  update();
})();
</script>
